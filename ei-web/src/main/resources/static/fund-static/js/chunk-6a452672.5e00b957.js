(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6a452672"],{"4d74":function(t,e,s){"use strict";s("4fa6")},"4fa6":function(t,e,s){},"56e1":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"quarterScreen"},[s("div",{staticClass:"quarter-screen-item",staticStyle:{"margin-bottom":"10px"}},[s("el-select",{attrs:{clearable:"",placeholder:"请选择短信内容"},on:{change:t.search,clear:t.search},model:{value:t.params.smsContent,callback:function(e){t.$set(t.params,"smsContent",e)},expression:"params.smsContent"}},t._l(t.smsModels,(function(t){return s("el-option",{key:t.code,attrs:{label:t.label,value:t.code}})})),1),t._v(" "),s("div",{staticClass:"quarter-type-title"},[t._v("状态：")]),t._v(" "),s("div",[s("link-tag",{attrs:{"context-path":t.url.urlApi,"parent-id":"60024",selectType:1,"cmargin-top":0,"cmax-width":"380"},on:{"update-value":t.search},model:{value:t.params.status,callback:function(e){t.$set(t.params,"status",e)},expression:"params.status"}})],1)],1),t._v(" "),s("div",[s("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.addMsg}},[t._v("\n        新增\n      ")])],1)])])},i=[],n=s("e19c"),o=s("ab08"),r=s("fa8a"),l={name:"search",model:{prop:"params",event:"update-value"},components:{linkTag:o["a"]},props:{params:{type:Object,default:function(){return{smsContent:"",status:""}}}},data:function(){return{isClose:!1,url:n["a"],smsModels:[],pickOption1:{disabledDate:function(t){return t.getFullYear()>(new Date).getFullYear()}}}},mounted:function(){this.initSmsModels()},methods:{search:function(){this.$emit("search")},addMsg:function(t){this.$emit("add",t)},exportData:function(t){this.$emit("export",t)},print:function(t){this.$emit("print",t)},initSmsModels:function(){var t=this;Object(r["mb"])().then((function(e){t.smsModels=e.data.list}))}}},c=l,u=(s("c3d5"),s("4ac2")),d=Object(u["a"])(c,a,i,!1,null,"4ff65c3e",null);e["default"]=d.exports},"65f3":function(t,e,s){"use strict";s("76ef")},"76ef":function(t,e,s){},ab08:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"tag",staticClass:"link-tag-box",style:{marginTop:t.cmarginTop+"px"}},[s("div",{staticClass:"all"},[s("span",{staticClass:"spa",class:{allActiveClass:t.isActive},on:{click:t.allTags}},[t._v("不限")])]),t._v(" "),s("el-row",{staticClass:"menu-content"},[s("el-col",{ref:"menu",style:{maxWidth:t.cmaxWidth+"px"},attrs:{span:24}},[s("div",{staticClass:"ul-contaier"},[s("ul",{staticClass:"tag-nav",class:{activeHeight:t.isActiveH}},t._l(t.options,(function(e,a){return s("li",{key:e.value,staticClass:"navItem",class:!0===e.checked?"activeClass":"",on:{click:function(e){return t.changeTags(a)}}},[s("span",[t._v(t._s(e.label))])])})),0),t._v(" "),t.isMoreShow?s("div",{staticClass:"col-handle"},[s("a",{staticClass:"open-btn icon-open-select",class:{open:t.isActiveH},attrs:{href:"javascript:void(0)"},on:{click:t.moreShow}})]):t._e()])])],1)],1)},i=[],n=(s("1bc7"),s("aa18"),s("982e"),s("fc02"),s("e680"),s("7f43")),o=s.n(n),r={name:"LinkTag",model:{prop:"value",event:"update-value"},props:{value:{type:String,default:""},contextPath:{type:String,default:"/ei-web/"},parentId:{type:String,default:""},include:{type:String,default:null},cmaxWidth:{type:[String,Number],default:"inherit"},cmarginTop:{type:Number,default:10},dataArr:{type:Array,default:function(){return[]}},selectType:{type:Number,default:1}},data:function(){return{isActive:!0,isActiveH:!1,isMoreShow:!1,filterMore:!0,multipleData:[],options:[]}},computed:{myValue:function(){return""!==this.value?this.value.split(","):[]},randomNum:function(){return this.dataArr.length+Math.ceil(10*Math.random())}},watch:{randomNum:function(t){this.updateParentCreateData(this.dataArr),this.updateParentData(this.dataArr)},value:function(t){""===t&&this.allTags()}},created:function(){},mounted:function(){var t=this;this.$nextTick((function(){if(t.dataArr.length>0)return t.updateParentCreateData(t.dataArr),void t.updateParentData(t.dataArr);var e=t.parentId;t.getCodeByParentId(e)}))},methods:{getCodeByParentId:function(t){var e=this,s="".concat(this.contextPath,"commonTCode/getCodeByParentId?parentId=").concat(t);o()({url:s,method:"get"}).then((function(t){var s=t.data;if("0"===s.status&&s.data.options){var a=s.data.options;e.updateParentCreateData(a),e.updateParentData(a)}}))},updateParentData:function(t){var e=this;this.$nextTick((function(){var s=e.cmaxWidth,a=t.length,i=70*a;"inherit"===s&&(s=e.$refs.tag.offsetWidth),s=parseInt(s),e.isMoreShow=i>s}))},updateParentCreateData:function(t){var e=this;this.$nextTick((function(){var s=[],a=t;if(e.include)for(var i=e.include.split(","),n=0;n<a.length;n++)i.includes(a[n].value)&&s.push(a[n]);else s=a;e.options=s,e.myValue.forEach((function(t,s){for(var a=0;a<e.options.length;a++)if(e.options[a].value===t){var i=e.options[a];i.checked=!0,e.$set(e.options,a,i),e.isActive=!1}}))}))},allTags:function(){for(var t in this.isActive=!0,this.options){var e=this.options[t];e.checked=!1,this.$set(this.options,t,e)}this.$emit("update-value","")},changeTags:function(t){console.log(t),this.isActive=!1;var e=this.selectType;if(1===e){var s=this.options[t];if(s.checked=!s.checked,this.$set(this.options,t,s),!0===this.options[t].checked){this.myValue.push(this.options[t].value);var a=this.myValue.join(",");this.$emit("update-value",a)}else{var i=this.options[t].value,n=this.myValue.indexOf(i);this.myValue.splice(n,1);var o=this.myValue.join(",");0===this.myValue.length&&(o="",this.isActive=!0),this.$emit("update-value",o)}}if(2===e){for(var r=0;r<this.options.length;r++){var l=this.options[r];l.checked=!1,this.$set(this.options,r,l)}var c=this.options[t];c.checked=!0,this.$set(this.options,t,c);var u=this.options[t].value;this.$emit("update-value",u)}},moreShow:function(){this.isActiveH=!this.isActiveH},clear:function(){this.allTags()}}},l=r,c=(s("65f3"),s("4ac2")),u=Object(c["a"])(l,a,i,!1,null,"0a292608",null);e["a"]=u.exports},ab9e:function(t,e,s){},c3d5:function(t,e,s){"use strict";s("ab9e")},cb82:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"tableContent",staticStyle:{margin:"0px 6px","margin-top":"24px"}},[s("div",{staticClass:"tableTitle"},[t._v(t._s(t.tableTitle))]),t._v(" "),s("search",{on:{add:t.add,search:t.search},model:{value:t.params,callback:function(e){t.params=e},expression:"params"}}),t._v(" "),s("div",{staticClass:"tableBox"},[s("el-table",{attrs:{data:t.tableData.data,"header-cell-style":{background:"#FEFAFA",color:"#333",fontSize:"12px",textAlign:"center"},border:""}},[s("el-table-column",{attrs:{label:"短信标题",prop:"smsContentName",align:"left","show-overflow-tooltip":!0,"min-width":"300"}}),t._v(" "),s("el-table-column",{attrs:{label:"发送对象",prop:"receivers",width:"300",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;e.$index;return[a.receivers.length<=30?s("span",[t._v(t._s(a.receivers))]):s("span",[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:a.receivers,placement:"top"}},[s("span",[t._v(" "+t._s(a.receivers.slice(0,30)+"...")+" ")])])],1)]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"发送人",prop:"senderName",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"发送时间",prop:"smsTimeStr",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"状态",prop:"smsStatusName",width:"120",align:"center"}}),t._v(" "),s("el-table-column",{attrs:{label:"操作",align:"center",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;e.$index;return["1"===a.smsStatus?s("div",[s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.handleEdit(a)}}},[t._v("编辑")]),t._v(" "),s("el-divider",{attrs:{direction:"vertical"}}),t._v(" "),s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.handleDelete(a)}}},[t._v("删除")]),t._v(" "),s("el-divider",{attrs:{direction:"vertical"}}),t._v(" "),s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.toDetail(a)}}},[t._v("详情")])],1):s("div",[s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.toDetail(a)}}},[t._v("详情")])],1)]}}])})],1),t._v(" "),s("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":t.tableData.currPage,"page-sizes":[5,10,20,30,40,50,60,70],"page-size":t.tableData.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.tableData.totalCount},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),s("el-dialog",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.submitLoading,expression:"submitLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{title:t.modalTitle,visible:t.dialogVisible,"close-on-click-modal":t.canModalClose,"element-loading-background":"rgba(0, 0, 0, 0)",width:"75%"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.dialogClose,opened:t.dialogOpen}},[s("form-page",{ref:"formPage",attrs:{"form-data":t.smsInfo,"info-editable":t.editable}}),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t.editable?s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.saveDraft()}}},[t._v("保 存")]):t._e(),t._v(" "),t.editable?s("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.addInfo()}}},[t._v("发 送")]):t._e(),t._v(" "),t.editable?s("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]):t._e(),t._v(" "),t.editable?t._e():s("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("关 闭")])],1)],1)],1)},i=[],n=(s("9f60"),s("94f0"),s("0c84"),s("2843"),s("4057"),s("a450"),s("698e")),o=s("fa8a"),r=s("a200"),l=s("56e1"),c=s("a698");function u(t,e){var s="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!s){if(Array.isArray(t)||(s=d(t))||e&&t&&"number"===typeof t.length){s&&(t=s);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,r=!1;return{s:function(){s=s.call(t)},n:function(){var t=s.next();return o=t.done,t},e:function(t){r=!0,n=t},f:function(){try{o||null==s.return||s.return()}finally{if(r)throw n}}}}function d(t,e){if(t){if("string"===typeof t)return f(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?f(t,e):void 0}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}var h={name:"SendMsg",components:{search:l["default"],formPage:c["default"]},mixins:[r["a"]],data:function(){return{tableTitle:"",hiddenUpload:!1,tableData:{data:[],pageSize:10,currPage:1},modalTitle:"",dialogVisible:!1,canModalClose:!1,submitLoading:!1,params:{smsContent:"",status:""},loading:!1,listLoading:!1,userInfo:{name:"",userId:"",companyName:"",companyId:"",deptName:"",deptId:""},smsInfo:{smsId:"",smsContent:"",details:[],finishDate:"",isFinish:"1"},editable:!0}},mounted:function(){this.tableTitle=this.$route.meta.title,this.getUserInfo(),this.getTableList()},methods:{getUserInfo:function(){var t=this;n["a"].getLoginUserInfo({}).then((function(e){var s=e.data;t.userInfo=s.data.loginUserInfo}))},getTableList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a={pageSize:e,currPage:s};Object.assign(a,this.params),a.status=a.status||"",a.smsContent=a.smsContent||"",this.listLoading=!0,Object(o["lb"])(a).then((function(e){console.log(e),t.tableData=e,t.listLoading=!1}))},add:function(){this.dialogVisible=!0,this.modalTitle="新增短信",this.smsInfo.senderId=this.userInfo.userId,this.smsInfo.senderName=this.userInfo.name,this.editable=!0},handleSizeChange:function(t){this.tableData.currPage=1,this.getTableList(t,1)},handleCurrentChange:function(t){this.getTableList(this.tableData.pageSize,t)},handleSelectionChange:function(t){this.selectList=t},handleEdit:function(t){this.modalTitle="编辑短信",this.smsInfo=JSON.parse(JSON.stringify(t)),this.editable=!0,this.dialogVisible=!0},dialogClose:function(){this.$refs.formPage.details=[],this.dialogVisible=!1,this.smsInfo={smsId:"",smsContent:"",details:[],finishDate:"",isFinish:"1"},this.$set(this.smsInfo,"attaFile","")},dialogOpen:function(){if("1"===this.smsInfo.smsStatus&&this.editable){var t,e=[],s=u(this.smsInfo.details);try{for(s.s();!(t=s.n()).done;){var a=t.value;e.push(a.receiveId)}}catch(i){s.e(i)}finally{s.f()}this.$refs.formPage.details=e}"0"===this.smsInfo.isFinish?this.$refs.formPage.needFinish=!1:this.$refs.formPage.needFinish=!0},handleDelete:function(t){var e=this,s=t.smsId;this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["g"])({smsId:s}).then((function(t){"0"===t.status&&"成功"===t.msg?(e.$message({offset:150,type:"success",message:"删除成功"}),e.getTableList()):e.$message({offset:150,type:"warning",message:t.msg})}))}))},saveDraft:function(){var t=this,e=this.$refs.formPage.details,s=this.$refs.formPage.entInfoMap;if(0!==e.length){this.smsInfo.details=[];var a,i=!0,n='<span style="font-size: 12px;line-height: 16px">',r=u(e);try{for(r.s();!(a=r.n()).done;){var l=a.value,c=/^1[3456789]\d{9}$/;c.test(s[l].phoneNo)||(i=!1,n+=s[l].adminName+"<br/>"),this.smsInfo.details.push(s[l])}}catch(d){r.e(d)}finally{r.f()}if(!i)return n+="手机号码格式不正确，请修改后刷新页面重试</span>",this.$message({offset:150,type:"warning",dangerouslyUseHTMLString:!0,message:n}),void(this.smsInfo.details=[]);""!==this.smsInfo.smsContent?(1!=this.smsInfo.isFinish||this.testParams(this.smsInfo.finishDate,"截止日期",!0,!1))&&(this.submitLoading=!0,this.smsInfo.smsStatus="1",this.smsInfo.smsModular="1",Object(o["a"])(this.smsInfo).then((function(e){t.submitLoading=!1,"0"===e.status&&"成功"===e.msg?(t.$message({offset:150,type:"success",message:"保存成功"}),t.getTableList(),t.dialogVisible=!1):t.$message({offset:150,type:"warning",message:e.msg})}))):this.$message({offset:150,type:"warning",message:"请选择短信内容"})}else this.$message({offset:150,type:"warning",message:"请选择发送对象"})},addInfo:function(){var t=this,e=this.$refs.formPage.details,s=this.$refs.formPage.entInfoMap;if(0!==e.length){this.smsInfo.details=[];var a=!0,i='<span style="font-size: 12px;line-height: 16px">';console.log(e);var n,r=u(e);try{for(r.s();!(n=r.n()).done;){var l=n.value,c=/^1[3456789]\d{9}$/;c.test(s[l].phoneNo)||(a=!1,i+=s[l].adminName+"<br/>"),this.smsInfo.details.push(s[l])}}catch(d){r.e(d)}finally{r.f()}if(!a)return i+="手机号码格式不正确，请修改后刷新页面重试</span>",this.$message({offset:150,type:"warning",dangerouslyUseHTMLString:!0,message:i}),void(this.smsInfo.details=[]);""!==this.smsInfo.smsContent?(1!=this.smsInfo.isFinish||this.testParams(this.smsInfo.finishDate,"截止日期",!0,!1))&&(this.smsInfo.smsStatus="2",this.smsInfo.smsModular="1",Object(o["a"])(this.smsInfo).then((function(e){t.submitLoading=!1,"0"===e.status&&"成功"===e.msg?(t.$message({offset:150,type:"success",message:"发送成功"}),t.getTableList(),t.dialogVisible=!1):t.$message({offset:150,type:"warning",message:e.msg})}))):this.$message({offset:150,type:"warning",message:"请选择短信内容"})}else this.$message({offset:150,type:"warning",message:"请选择发送对象"})},toDetail:function(t){this.editable=!1,this.modalTitle="查看",this.smsInfo=JSON.parse(JSON.stringify(t)),this.dialogVisible=!0},search:function(){this.getTableList()}}},m=h,p=(s("4d74"),s("4ac2")),g=Object(p["a"])(m,a,i,!1,null,"6e741a9b",null);e["default"]=g.exports}}]);